import{a as t,t as E,b as u,c as Q}from"../chunks/disclose-version.T6rPbwlf.js";import{p as Oe,f as b,a as Fe,g as e,b as n,t as T,d as V,c as o,s as l,n as P,r as s,e as ie}from"../chunks/runtime.D1Gg6DO2.js";import{s as x}from"../chunks/render.5P34H023.js";import{i as y,a as le}from"../chunks/props.CI-ns3SY.js";import{M as Me,S as De,e as fe,C as $e,B as he,i as _e}from"../chunks/Modal.COU9KHHK.js";import"../chunks/legacy.Dawxrsww.js";import{B as W,L as ye,I as Te,A as Re}from"../chunks/Input.Dsvr9uOF.js";var Ee=E('<div class="text-lg font-medium"> </div> <div class="text-sm text-gray-600"> </div> <div class="mt-2 flex items-center justify-between"><!> <!></div>',1),Ie=E('<div class="text-lg font-medium"> </div> <div class="text-sm text-gray-600"> </div> <div class="mt-2 flex items-center justify-between"><!> <!></div>',1),Ue=E('<div class="text-lg font-medium"> </div> <div class="text-sm text-gray-600"> </div> <div class="mt-2 flex items-center justify-between"><!> <!></div>',1),ke=E('<div class="grid grid-cols-1 md:grid-cols-3 gap-8"><div><h2 class="text-xl font-semibold mb-4"> </h2> <div class="space-y-4"></div></div> <div><h2 class="text-xl font-semibold mb-4"> </h2> <div class="space-y-4"></div></div> <div><h2 class="text-xl font-semibold mb-4"> </h2> <div class="space-y-4"></div></div></div>'),Je=E("<option> </option>"),Ne=E("<option>Select a plan</option> <!>",1),Ge=E('<div class="text-center"><h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400"> </h3> <p class="mb-5 text-sm text-gray-500">Select a subscription plan and upload your proof of payment.</p></div> <!> <div class="grid gap-4 py-4"><div class="grid gap-2"><!> <!></div> <div class="grid gap-2"><!> <!> <p class="text-sm text-gray-500">Upload a screenshot or photo of your payment receipt (Max 5MB)</p></div></div> <div class="flex justify-end gap-4"><!> <!></div>',1),He=E('<div class="container mx-auto p-4"><div class="grid grid-cols-3 items-center mb-8"><div></div> <h1 class="text-2xl font-bold text-center">Available Lockers</h1> <!></div> <!> <!></div> <!>',1);function et(we,j){Oe(j,!0);let X=V(null),I=V(""),H=V(null),oe=V(!1),S=V(null),ne=V(!1);function qe(){return{small:j.data.lockers.filter(a=>a.size.toLowerCase()==="small"),medium:j.data.lockers.filter(a=>a.size.toLowerCase()==="medium"),large:j.data.lockers.filter(a=>a.size.toLowerCase()==="large")}}function me(a){a.hasPendingRequest||(n(X,le(a)),n(I,""),n(H,null),n(S,null),n(ne,!0))}function xe(){n(ne,!1),n(X,null),n(I,""),n(H,null),n(S,null)}async function Le(a){var h;const g=(h=a.target.files)==null?void 0:h[0];if(g){if(g.size>5*1024*1024){n(S,"File size must be less than 5MB");return}try{const z=await new Promise((Y,U)=>{const B=new FileReader;B.onload=()=>{const k=B.result.split(",")[1];Y(k)},B.onerror=U,B.readAsDataURL(g)});n(H,le(z)),n(S,null)}catch(z){console.error("Error reading file:",z),n(S,"Failed to read file")}}}async function Se(){if(!e(X)||!e(I)||!e(H)){n(S,"Please fill in all required fields");return}n(oe,!0),n(S,null);try{const a=await fetch("/api/lockers/request",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({lockerId:e(X).id,subscriptionTypeId:e(I),proofOfPayment:e(H)})});if(!a.ok){const A=await a.json();if(a.status===401){window.location.href="/";return}throw new Error(A.message||"Failed to submit request")}xe(),window.location.reload()}catch(a){console.error("Error:",a),n(S,le(a instanceof Error?a.message:"Failed to submit request"))}finally{n(oe,!1)}}var be=He(),ge=b(be),pe=o(ge),Ae=l(o(pe),4);W(Ae,{href:"/dashboard",color:"blue",class:"justify-self-end",children:(a,A)=>{P();var g=u("Back to Dashboard");t(a,g)},$$slots:{default:!0}}),s(pe);var Pe=l(pe,2);{var ze=a=>{Re(a,{color:"red",class:"mb-8",children:(A,g)=>{P();var h=u();T(()=>x(h,j.data.error)),t(A,h)},$$slots:{default:!0}})};y(Pe,a=>{j.data.error&&a(ze)})}var Be=l(Pe,2);{var Ce=a=>{var A=ke();const g=ie(qe);var h=o(A),z=o(h),Y=o(z);s(z);var U=l(z,2);fe(U,21,()=>e(g).small,_e,(F,r)=>{$e(F,{padding:"sm",children:(J,ce)=>{var i=Ee(),c=b(i),_=o(c);s(c);var f=l(c,2),N=o(f);s(f);var C=l(f,2),p=o(C),R=ie(()=>e(r).hasPendingRequest?"yellow":e(r).isAvailable?"green":"red");he(p,{get color(){return e(R)},children:(m,D)=>{var w=Q(),q=b(w);{var ee=d=>{var $=u("Pending Request");t(d,$)},te=d=>{var $=Q(),ae=b($);{var re=v=>{var L=u("Available");t(v,L)},se=v=>{var L=u("Occupied");t(v,L)};y(ae,v=>{e(r).isAvailable?v(re):v(se,!1)},!0)}t(d,$)};y(q,d=>{e(r).hasPendingRequest?d(ee):d(te,!1)})}t(m,w)},$$slots:{default:!0}});var M=l(p,2);{var G=m=>{W(m,{color:"light",$$events:{click:()=>me(e(r))},children:(D,w)=>{P();var q=u("Rent");t(D,q)},$$slots:{default:!0}})};y(M,m=>{e(r).isAvailable&&!e(r).hasPendingRequest&&m(G)})}s(C),T(()=>{x(_,`Locker #${e(r).number??""}`),x(N,`Size: ${e(r).size??""}`)}),t(J,i)},$$slots:{default:!0}})}),s(U),s(h);var B=l(h,2),O=o(B),k=o(O);s(O);var Z=l(O,2);fe(Z,21,()=>e(g).medium,_e,(F,r)=>{$e(F,{padding:"sm",children:(J,ce)=>{var i=Ie(),c=b(i),_=o(c);s(c);var f=l(c,2),N=o(f);s(f);var C=l(f,2),p=o(C),R=ie(()=>e(r).hasPendingRequest?"yellow":e(r).isAvailable?"green":"red");he(p,{get color(){return e(R)},children:(m,D)=>{var w=Q(),q=b(w);{var ee=d=>{var $=u("Pending Request");t(d,$)},te=d=>{var $=Q(),ae=b($);{var re=v=>{var L=u("Available");t(v,L)},se=v=>{var L=u("Occupied");t(v,L)};y(ae,v=>{e(r).isAvailable?v(re):v(se,!1)},!0)}t(d,$)};y(q,d=>{e(r).hasPendingRequest?d(ee):d(te,!1)})}t(m,w)},$$slots:{default:!0}});var M=l(p,2);{var G=m=>{W(m,{color:"light",$$events:{click:()=>me(e(r))},children:(D,w)=>{P();var q=u("Rent");t(D,q)},$$slots:{default:!0}})};y(M,m=>{e(r).isAvailable&&!e(r).hasPendingRequest&&m(G)})}s(C),T(()=>{x(_,`Locker #${e(r).number??""}`),x(N,`Size: ${e(r).size??""}`)}),t(J,i)},$$slots:{default:!0}})}),s(Z),s(B);var de=l(B,2),K=o(de),ve=o(K);s(K);var ue=l(K,2);fe(ue,21,()=>e(g).large,_e,(F,r)=>{$e(F,{padding:"sm",children:(J,ce)=>{var i=Ue(),c=b(i),_=o(c);s(c);var f=l(c,2),N=o(f);s(f);var C=l(f,2),p=o(C),R=ie(()=>e(r).hasPendingRequest?"yellow":e(r).isAvailable?"green":"red");he(p,{get color(){return e(R)},children:(m,D)=>{var w=Q(),q=b(w);{var ee=d=>{var $=u("Pending Request");t(d,$)},te=d=>{var $=Q(),ae=b($);{var re=v=>{var L=u("Available");t(v,L)},se=v=>{var L=u("Occupied");t(v,L)};y(ae,v=>{e(r).isAvailable?v(re):v(se,!1)},!0)}t(d,$)};y(q,d=>{e(r).hasPendingRequest?d(ee):d(te,!1)})}t(m,w)},$$slots:{default:!0}});var M=l(p,2);{var G=m=>{W(m,{color:"light",$$events:{click:()=>me(e(r))},children:(D,w)=>{P();var q=u("Rent");t(D,q)},$$slots:{default:!0}})};y(M,m=>{e(r).isAvailable&&!e(r).hasPendingRequest&&m(G)})}s(C),T(()=>{x(_,`Locker #${e(r).number??""}`),x(N,`Size: ${e(r).size??""}`)}),t(J,i)},$$slots:{default:!0}})}),s(ue),s(de),s(A),T(()=>{x(Y,`Small Lockers (${e(g).small.length??""})`),x(k,`Medium Lockers (${e(g).medium.length??""})`),x(ve,`Large Lockers (${e(g).large.length??""})`)}),t(a,A)};y(Be,a=>{j.data.lockers&&a(Ce)})}s(ge);var je=l(ge,2);Me(je,{size:"md",autoclose:!0,get open(){return e(ne)},set open(a){n(ne,le(a))},children:(a,A)=>{var g=Ge(),h=b(g),z=o(h),Y=o(z);s(z),P(2),s(h);var U=l(h,2);{var B=i=>{Re(i,{color:"red",class:"mb-4",children:(c,_)=>{P();var f=u();T(()=>x(f,e(S))),t(c,f)},$$slots:{default:!0}})};y(U,i=>{e(S)&&i(B)})}var O=l(U,2),k=o(O),Z=o(k);ye(Z,{for:"plan",children:(i,c)=>{P();var _=u("Subscription Plan");t(i,_)},$$slots:{default:!0}});var de=l(Z,2);De(de,{id:"plan",get value(){return e(I)},set value(i){n(I,le(i))},children:(i,c)=>{var _=Ne(),f=b(_);f.value=((f.__value="")==null,"");var N=l(f,2);fe(N,17,()=>j.data.subscriptionTypes,_e,(C,p)=>{var R=Je(),M={},G=o(R);s(R),T(()=>{M!==(M=e(p).id)&&(R.value=(R.__value=e(p).id)==null?"":e(p).id),x(G,`${e(p).name??""} - â‚±${e(p).amount??""} (${e(p).duration??""})`)}),t(C,R)}),t(i,_)},$$slots:{default:!0}}),s(k);var K=l(k,2),ve=o(K);ye(ve,{for:"proof",children:(i,c)=>{P();var _=u("Proof of Payment");t(i,_)},$$slots:{default:!0}});var ue=l(ve,2);Te(ue,{id:"proof",type:"file",accept:"image/*",$$events:{change:Le}}),P(2),s(K),s(O);var F=l(O,2),r=o(F);W(r,{color:"alternative",$$events:{click:xe},children:(i,c)=>{P();var _=u("Cancel");t(i,_)},$$slots:{default:!0}});var J=l(r,2),ce=ie(()=>!e(I)||!e(H)||e(oe));W(J,{color:"blue",get disabled(){return e(ce)},get loading(){return e(oe)},$$events:{click:Se},children:(i,c)=>{P();var _=u("Submit Request");t(i,_)},$$slots:{default:!0}}),s(F),T(()=>{var i;return x(Y,`Rent Locker #${((i=e(X))==null?void 0:i.number)??""}`)}),t(a,g)},$$slots:{default:!0}}),t(we,be),Fe()}export{et as component};
