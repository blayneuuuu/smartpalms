import{l as Le,a as i,t as M,c as le,b,s as L}from"../chunks/disclose-version.DAuCITe-.js";import{m as he,y as ze,z as H,A as De,v as o,w as s,x as r,B as U,j as e,C as J,D as Z,F as f,l as be}from"../chunks/index-client.A1mlkm1m.js";import{i as Oe,a as O,p as ce}from"../chunks/props.BzQReNhN.js";import{R as Be,e as ne,D as Fe,a as je,b as Ce,c as Ie,L as xe,I as Me,d as Te,B as oe,s as k,i as de}from"../chunks/label.BzEx-SLr.js";import{c as ee}from"../chunks/svelte-component.Ua6OYMEt.js";function $e(n,g,x){if(n.multiple)return Je(n,g);for(var h of n.options){var $=ie(h);if(Oe($,g)){h.selected=!0;return}}(!x||g!==void 0)&&(n.selectedIndex=-1)}function Ee(n,g){he(()=>{var x=new MutationObserver(()=>{var h=n.__value;$e(n,h)});return x.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{x.disconnect()}})}function Ue(n,g,x=g){var h=!0;Le(n,"change",$=>{var F=$?"[selected]":":checked",y;if(n.multiple)y=[].map.call(n.querySelectorAll(F),ie);else{var K=n.querySelector(F)??n.querySelector("option:not([disabled])");y=K&&ie(K)}x(y)}),he(()=>{var $=g();if($e(n,$,h),h&&$===void 0){var F=n.querySelector(":checked");F!==null&&($=ie(F),x($))}n.__value=$,h=!1}),Ee(n)}function Je(n,g){for(var x of n.options)x.selected=~g.indexOf(ie(x))}function ie(n){return"__value"in n?n.__value:n.value}var Ne=M('<div class="bg-red-100 text-red-700 p-4 rounded mb-8"> </div>'),We=M('<div><div class="text-lg font-medium"> </div> <div class="text-sm text-gray-600"> </div> <div class="mt-2 flex items-center justify-between"><span><!></span> <!></div></div>'),Ge=M('<div><div class="text-lg font-medium"> </div> <div class="text-sm text-gray-600"> </div> <div class="mt-2 flex items-center justify-between"><span><!></span> <!></div></div>'),He=M('<div><div class="text-lg font-medium"> </div> <div class="text-sm text-gray-600"> </div> <div class="mt-2 flex items-center justify-between"><span><!></span> <!></div></div>'),Ke=M('<div class="grid grid-cols-1 md:grid-cols-3 gap-8"><div><h2 class="text-xl font-semibold mb-4"> </h2> <div class="space-y-4"></div></div> <div><h2 class="text-xl font-semibold mb-4"> </h2> <div class="space-y-4"></div></div> <div><h2 class="text-xl font-semibold mb-4"> </h2> <div class="space-y-4"></div></div></div>'),Qe=M("<!> <!>",1),Ve=M('<div class="bg-red-100 text-red-700 p-3 rounded mb-4"> </div>'),Xe=M("<option> </option>"),Ye=M('<!> <!> <div class="grid gap-4 py-4"><div class="grid gap-2"><!> <select id="plan" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"><option>Select a plan</option><!></select></div> <div class="grid gap-2"><!> <!> <p class="text-sm text-gray-500">Upload a screenshot or photo of your payment receipt (Max 5MB)</p></div></div> <!>',1),Ze=M('<div class="container mx-auto p-4"><div class="grid grid-cols-3 items-center mb-8"><div></div> <h1 class="text-2xl font-bold text-center">Available Lockers</h1> <a href="/dashboard" class="justify-self-end bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm font-semibold">Back to Dashboard</a></div> <!> <!></div> <!>',1);function ia(n,g){ze(g,!0);let x=Z(null),h=Z(""),$=Z(null),F=Z(!1),y=Z(null),K=Z(!1);function ye(){return{small:g.data.lockers.filter(l=>l.size.toLowerCase()==="small"),medium:g.data.lockers.filter(l=>l.size.toLowerCase()==="medium"),large:g.data.lockers.filter(l=>l.size.toLowerCase()==="large")}}function ve(l){l.hasPendingRequest||(f(x,ce(l)),f(h,""),f($,null),f(y,null),f(K,!0))}function _e(){f(K,!1),f(x,null),f(h,""),f($,null),f(y,null)}async function Pe(l){var W;const p=(W=l.target.files)==null?void 0:W[0];if(!p){f(y,"Please select a file");return}if(p.size>5*1024*1024){f(y,"File size must be less than 5MB");return}if(!p.type.startsWith("image/")){f(y,"Please upload an image file");return}try{const j=await new Promise((ae,Q)=>{const B=new FileReader;B.onload=()=>{const se=B.result.split(",")[1];ae(se)},B.onerror=()=>Q(B.error),B.readAsDataURL(p)});f($,ce(j)),f(y,null)}catch(j){console.error("Error reading file:",j),f(y,"Failed to process image")}}async function Re(){if(!e(x)||!e(h)||!e($)){f(y,"Please fill in all required fields");return}f(F,!0),f(y,null);try{const l=await fetch("/api/lockers/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lockerId:e(x).id,subscriptionTypeId:e(h),proofOfPayment:e($)})});if(!l.ok){const z=await l.json().catch(()=>({}));throw new Error(z.message||"Failed to submit request")}_e(),window.location.reload()}catch(l){console.error("Error:",l),f(y,ce(l instanceof Error?l.message:"Failed to submit request"))}finally{f(F,!1)}}var ge=Ze(),ue=H(ge),me=o(s(ue),2);{var we=l=>{var z=Ne(),p=s(z,!0);r(z),U(()=>L(p,g.data.error)),i(l,z)};O(me,l=>{g.data.error&&l(we)})}var qe=o(me,2);{var Se=l=>{var z=Ke();const p=be(ye);var W=s(z),j=s(W),ae=s(j);r(j);var Q=o(j,2);ne(Q,21,()=>e(p).small,de,(T,a)=>{var m=We(),w=s(m),G=s(w);r(w);var A=o(w,2),N=s(A);r(A);var C=o(A,2),P=s(C),c=s(P);{var v=t=>{var d=b("Pending Request");i(t,d)},_=t=>{var d=le(),q=H(d);{var S=u=>{var R=b("Available");i(u,R)},E=u=>{var R=b("Occupied");i(u,R)};O(q,u=>{e(a).isAvailable?u(S):u(E,!1)},!0)}i(t,d)};O(c,t=>{e(a).hasPendingRequest?t(v):t(_,!1)})}r(P);var I=o(P,2);{var D=t=>{oe(t,{variant:"outline",$$events:{click:()=>ve(e(a))},children:(d,q)=>{J();var S=b("Rent");i(d,S)},$$slots:{default:!0}})};O(I,t=>{e(a).isAvailable&&!e(a).hasPendingRequest&&t(D)})}r(C),r(m),U(()=>{k(m,`border rounded-lg p-4 ${(e(a).hasPendingRequest?"bg-yellow-50":e(a).isAvailable?"bg-gray-100":"bg-red-50")??""}`),L(G,`Locker #${e(a).number??""}`),L(N,`Size: ${e(a).size??""}`),k(P,e(a).hasPendingRequest?"text-yellow-600":e(a).isAvailable?"text-green-600":"text-red-600")}),i(T,m)}),r(Q),r(W);var B=o(W,2),V=s(B),se=s(V);r(V);var te=o(V,2);ne(te,21,()=>e(p).medium,de,(T,a)=>{var m=Ge(),w=s(m),G=s(w);r(w);var A=o(w,2),N=s(A);r(A);var C=o(A,2),P=s(C),c=s(P);{var v=t=>{var d=b("Pending Request");i(t,d)},_=t=>{var d=le(),q=H(d);{var S=u=>{var R=b("Available");i(u,R)},E=u=>{var R=b("Occupied");i(u,R)};O(q,u=>{e(a).isAvailable?u(S):u(E,!1)},!0)}i(t,d)};O(c,t=>{e(a).hasPendingRequest?t(v):t(_,!1)})}r(P);var I=o(P,2);{var D=t=>{oe(t,{variant:"outline",$$events:{click:()=>ve(e(a))},children:(d,q)=>{J();var S=b("Rent");i(d,S)},$$slots:{default:!0}})};O(I,t=>{e(a).isAvailable&&!e(a).hasPendingRequest&&t(D)})}r(C),r(m),U(()=>{k(m,`border rounded-lg p-4 ${(e(a).hasPendingRequest?"bg-yellow-50":e(a).isAvailable?"bg-gray-100":"bg-red-50")??""}`),L(G,`Locker #${e(a).number??""}`),L(N,`Size: ${e(a).size??""}`),k(P,e(a).hasPendingRequest?"text-yellow-600":e(a).isAvailable?"text-green-600":"text-red-600")}),i(T,m)}),r(te),r(B);var re=o(B,2),X=s(re),fe=s(X);r(X);var Y=o(X,2);ne(Y,21,()=>e(p).large,de,(T,a)=>{var m=He(),w=s(m),G=s(w);r(w);var A=o(w,2),N=s(A);r(A);var C=o(A,2),P=s(C),c=s(P);{var v=t=>{var d=b("Pending Request");i(t,d)},_=t=>{var d=le(),q=H(d);{var S=u=>{var R=b("Available");i(u,R)},E=u=>{var R=b("Occupied");i(u,R)};O(q,u=>{e(a).isAvailable?u(S):u(E,!1)},!0)}i(t,d)};O(c,t=>{e(a).hasPendingRequest?t(v):t(_,!1)})}r(P);var I=o(P,2);{var D=t=>{oe(t,{variant:"outline",$$events:{click:()=>ve(e(a))},children:(d,q)=>{J();var S=b("Rent");i(d,S)},$$slots:{default:!0}})};O(I,t=>{e(a).isAvailable&&!e(a).hasPendingRequest&&t(D)})}r(C),r(m),U(()=>{k(m,`border rounded-lg p-4 ${(e(a).hasPendingRequest?"bg-yellow-50":e(a).isAvailable?"bg-gray-100":"bg-red-50")??""}`),L(G,`Locker #${e(a).number??""}`),L(N,`Size: ${e(a).size??""}`),k(P,e(a).hasPendingRequest?"text-yellow-600":e(a).isAvailable?"text-green-600":"text-red-600")}),i(T,m)}),r(Y),r(re),r(z),U(()=>{L(ae,`Small Lockers (${e(p).small.length??""})`),L(se,`Medium Lockers (${e(p).medium.length??""})`),L(fe,`Large Lockers (${e(p).large.length??""})`)}),i(l,z)};O(qe,l=>{g.data.lockers&&l(Se)})}r(ue);var Ae=o(ue,2);ee(Ae,()=>Be,(l,z)=>{z(l,{get open(){return e(K)},onOpenChange:p=>!p&&_e(),children:(p,W)=>{var j=le(),ae=H(j);ee(ae,()=>Fe,(Q,B)=>{B(Q,{class:"sm:max-w-[425px]",children:(V,se)=>{var te=Ye(),re=H(te);ee(re,()=>je,(c,v)=>{v(c,{children:(_,I)=>{var D=Qe(),t=H(D);ee(t,()=>Ce,(q,S)=>{S(q,{children:(E,u)=>{J();var R=b();U(()=>{var pe;return L(R,`Rent Locker #${((pe=e(x))==null?void 0:pe.number)??""}`)}),i(E,R)},$$slots:{default:!0}})});var d=o(t,2);ee(d,()=>Ie,(q,S)=>{S(q,{children:(E,u)=>{J();var R=b("Select a subscription plan and upload your proof of payment.");i(E,R)},$$slots:{default:!0}})}),i(_,D)},$$slots:{default:!0}})});var X=o(re,2);{var fe=c=>{var v=Ve(),_=s(v,!0);r(v),U(()=>L(_,e(y))),i(c,v)};O(X,c=>{e(y)&&c(fe)})}var Y=o(X,2),T=s(Y),a=s(T);xe(a,{for:"plan",children:(c,v)=>{J();var _=b("Subscription Plan");i(c,_)},$$slots:{default:!0}});var m=o(a,2),w=s(m);w.value=((w.__value="")==null,"");var G=o(w);ne(G,17,()=>g.data.subscriptionTypes,de,(c,v)=>{var _=Xe(),I={},D=s(_);r(_),U(()=>{I!==(I=e(v).id)&&(_.value=(_.__value=e(v).id)==null?"":e(v).id),L(D,`${e(v).name??""} - â‚±${e(v).amount??""} (${e(v).duration??""})`)}),i(c,_)}),r(m),r(T);var A=o(T,2),N=s(A);xe(N,{for:"proof",children:(c,v)=>{J();var _=b("Proof of Payment");i(c,_)},$$slots:{default:!0}});var C=o(N,2);Me(C,{id:"proof",type:"file",accept:"image/*",$$events:{change:Pe}}),J(2),r(A),r(Y);var P=o(Y,2);ee(P,()=>Te,(c,v)=>{v(c,{children:(_,I)=>{var D=be(()=>e(F)||!e(h)||!e($));oe(_,{get disabled(){return e(D)},$$events:{click:Re},children:(t,d)=>{J();var q=b();U(()=>L(q,e(F)?"Submitting...":"Submit Request")),i(t,q)},$$slots:{default:!0}})},$$slots:{default:!0}})}),Ue(m,()=>e(h),c=>f(h,c)),i(V,te)},$$slots:{default:!0}})}),i(p,j)},$$slots:{default:!0}})}),i(n,ge),De()}export{ia as component};
